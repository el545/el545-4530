##Introduction


Acid precipitation has been a serious environmental problem in many areas of the world; one of its most significant impacts is the acidification of lakes and streams.
The major parameter of this concern is pH. In these freshwater systems, the dominant
 pH buffering system is the carbonate system, which has four components:
 dissolved carbon dioxide ($CO_{2 (aq)}$), carbonic acid ($H_2CO_3$), bicarbonate ($HCO_3^-$), and carbonate ($CO_3^2-$). The sum of the molar concentrations of all of the components
 is denoted as $C_T$.
 $C_T = \left[H_2{CO}3^* \right] + \left[{HCO}_3^- \right]+\left[{CO}_3^{-2} \right]$,
 where $\left[{H}_{{2}} {CO}_{{3}}^{{}}\right]=\left[{CO}_{{2}.{aq}}\right] \left[{H}{{2}} {CO}_{{3}} \right]$ because carbonic acid exists at very low concentration in lakes . In order to determine whether the carbonate system is “volatile ” or “non-volatile”, mixing conditions and hydraulic residence time are used. Acid neutralizing capacity (ANC) is a measure of the ability of water to neutralize acid inputs. For lakes, ANC is a reflection of the mineral composition of the watershed.


 The following equations show the relationships for a non-volatile system:

 $$\left[H_2 {CO}_3^* \right] = \frac{C_T}{1+\frac{K_1}{[H^+]} +\frac{K_1 K_2}{[H^+]^2} } = \alpha_0 C_T \text{, where }\alpha_0 =\frac{1}{1+\frac{K_1 }{[H^+]} +\frac{K_1 K_2}{[H^+]^2}}$$

 $$\left[{HCO}_3^- \right]=\frac{C_T}{\frac{[H^+ ]}{K_1 } +1+ \frac{K_2}{[H^+]}} =\alpha_1 C_T \text{, where } \alpha_1 = \frac{1}{\frac{[H^+]}{K_1} + 1 + \frac{K_2}{[H^+]}}$$

 $$\left[{CO}_3^{-2} \right] = \frac{C_T}{\frac{[H^+]^2}{K_1 K_2} +\frac{[H^+]}{K_2} +1 } =\alpha_2 C_T \text{, where } \alpha_2 = \frac{1}{\frac{[H^+]^2 }{K_1 K_2} +\frac{[H^+]}{K_2} + 1}$$

 $${ANC }={ }\left[{HCO}{{3}}^{{-}} \right]+{ 2}\left[{CO}{{3}}^{{-2}}
  \right]+\left[{OH}^{{-}} \right]{ -}\left[{H}^{+} \right]$$
  $$=C_T \left(\alpha_1 +2\alpha_2 \right)+\frac{K_w}{\left[H^+ \right]} - \left[H^+ \right]$$

  The violatule system is the case where aqueous ${CO}_{2}$ is volatile and in equilibrium with atmospheric carbon dioxide, using Henry’s law: $\left[{CO}{{2; aq}} \right]={ P}_{{CO}_{{2}} {; }} {K}{{H}}$. From the previous equations, we could derive the equilibrium concentration of carbonate species with pH and partial pressure of carbon dioxide: $C_T = \frac{P_{CO_2} K_H}{\alpha_0}$. Thus, the ANC for a volatile system could be written as: $ANC=\frac{P_{CO_2} K_H }{\alpha_0 } (\alpha_1 +2\alpha_2 ) + \frac{K_w }{\left[H^+ \right]} - \left[H^+ \right]$

##Objective
  In the first part of the experiment, we want to remediate an acid lake by adding ANC, through adding sodium bicarbonate, to raise and maintain the pH value to an acceptable level. Sodium bicarbonate will be added directly to a lake with an initial ANC of 0 \mu eq/L and receives acid rain with pH=3. Sodium bicarbonate will be applied continuously; during this the lake pH and ANC will be monitored over a period of approximately 20 minute.

  In the second part of the experiment, we determine ANC of a known sample and ANC of acid rain samples, using the samples from the previous part. In order to determine the equivalent point of titration, we need to find out the equivalent volume, using the formula: $V_{e} {\; =}\frac{V_{s} \cdot N_{s} }{N_{t} }$, where “N” means the normality and “V” means volume while the subscript “s” indicates sample and the subscript “t” indicates titrant. From titration data of titration volume and pH, we could reveal the equivalent volume through the shape of the titration curve( $V_t$ versus pH) and the inflection point, which would be found by looking for the maximum from the first derivative of the titration plot. In order to find the ANC for the unknown solution, we will use the Gran plot technique that ANC will be obtained as a function of the equivalent volume: $ANC=\frac{V_e N_t }{V_s }$.

  ##Procedure

In the first part of acid precipitation and remediation of acid lakes:
1) Setup the experimental apparatus with an acid rain storage reservoir, peristaltic pump, and lake and verify the pumping works correctly and the lake outflow discharge to the drain.
2) Measure the pH using a pH probe. The pH probe need to be connected to a signal-conditioning box for ProCoDA to monitor the pH of the lake. The pH probe needs to be calibrated properly for further use.
3) Preset the desired flow rate for the pump, based on the tubing size. In our experiment, we chose to set the desired flow rate to be 267 mL/min, as we had a tubing size of 18.
4) Fill the lake to be approximately 4 L and place it on the magnetic stirrer with a stir bar added. Set the stirrer speed to be 8.
5) Add 1 mL of bromocresol green indicator solution to the lake and add 623 mg NaHCO_3 to it.
6) Take 100mL sample from the lake after a well mix and label the first sample with the time.
7) Clip the pH probe in a proper place away from influent and effluent and be ready to measure the pH of the effluent continuously.
8) Set the data log interval to be 1 second and start to log the data. Remember to add a comment at time equal to zero.
9) Take out a 100 mL sample from the lake effluent at 5, 10, 15 and 20 minutes and label them.
10) After collecting all the samples, measure the flow rate through determining the volume of water from a 30 seconds collection.
11) Turn off the pump and stop measuring pH.
12) Measure the lake volume by a large graduated cylinder.
13) Repeat step 4 to 12 with a double initial ANC.

In the second part of the ANC measurement:

Determine ANC of a known sample:
1) Use an electronic balance to measure approximately 50 mL reverse osmosis water in a 100 mL beaker.
2) Place the beaker on the magnetic stirrer and add the stir bar to stir slowly.
3) Place the pH electrode in the solution
4) Add 0.05N HCl titrant and start to analyze the sample using Gran plot analysis.
5) Save the Gran data for later analysis.

Determine ANC of acid rain samples from part 1:

1) Use an electronic balance to measure approximately 50 mL sample  in a 100 mL beaker.
2) Place the beaker on the magnetic stirrer and add the stir bar to stir slowly.
3) Place the pH electrode in the solution
4) Record initial pH and initial sample volume
 If the pH is less than 4.5, the equation $ANC=[H^+]$ could be used to calculate ANC directly instead of titration, else.
5) Add 0.05N HCl titrant and start to analyze the sample using Gran plot analysis.
6) Save the Gran data for later analysis.

##Results and Discussion

After completing the procedure, data concerning the pH over time of the lake is obtained, as
is data concerning the ANC of lake over time.

<div style = "text-align:center">

![linear](https://raw.githubusercontent.com/el545/el545-4530/master/ANC%20Titrations/pH%20vs%20V_titrant.png)

Figure 1. pH of the lake at time 0 as a function of titrant volume


<div style = "text-align: left">
Via Atom and Python, we graphed the pH of the lake at time 0 as a function of the amount of titrant --0.05 N HCl, which can be seen in the figure above. The vertical lines in the graph denote when the reaction has started and stopped, and in between the lines is when the reaction takes place. This is evident in the steeper slope in the region. Before the first line, the pH of the lake is too high for the reaction to occur . After the second line, the pH is at around 3.5, so the reaction has completed.


<div style = "text-align:center">

![linear](https://raw.githubusercontent.com/el545/el545-4530/master/ANC%20Titrations/time%200%20.png)

Figure 2. Gran plot of the data from time 0

<div style = "text-align: left">
The above plot is the Gran Plot for
With proCoDA, we get an Ve --equivalent volume-- of 0.633 mL. From our actual calculations,
we get a value of
<div style = "text-align:center">

![linear](https://raw.githubusercontent.com/el545/el545-4530/master/ANC%20Titrations/ANC%20lab/part3.png)

Figure 3.  Actual ANC of lake and various models of ANC
<div style = "text-align: left">
As seen in Figure 3, the actual ANC of the lake most closely aligns with the closed and open ANC models.


The data for time = 15 minutes may be skewed by human error; it has a lower
$R^2$ value than the other values at 0.938, whereas the $R^2$ values for the other
times are all greater than 0.99. This was caused by recording the data for the Gran Plot
too quickly and not waiting for the values to stabilize. Thus, if the experiment
were to be repeated, then we would wait for the Gran plots to visually stabilize on
ProCoDA before recording the data points.
























##Conclusion


##Appendix

```python
from aguaclara.core.units import unit_registry as u
u.define('equivalent = mole = eq')
import aguaclara.research.environmental_processes_analysis as epa
import aguaclara.core.utility as ut
from scipy import optimize
import numpy as np
import math
from scipy import special
import aguaclara.core.physchem as pc
from aguaclara.research.procoda_parser import *
from scipy.optimize import curve_fit
import collections
import matplotlib.pyplot as plt
import pandas as pd
from scipy import stats

Gran_datat0 = "https://raw.githubusercontent.com/el545/el545-4530/master/ANC%20Titrations/lab%203%20titration%20time%200.tsv"


# The epa.Gran function imports data from your Gran data file as saved by ProCoDA.
# The epa.Gran function assigns all of the outputs in one statement
V_titrant, pH, V_Sample, Normality_Titrant, V_equivalent, ANC = epa.Gran(Gran_datat0)
ANC0 = ANC
#plotting the pH vs. equivalent volume of Titrant
#Question: do we have to call Gran to get the pH and V Titrant

plt.plot(V_titrant, pH, 'r')
plt.axvline(x = 0.6, color = 'y')
plt.axvline(x = 0.8, color = 'y')
plt.xlabel("Titrant Volume (mL)")
plt.ylabel("pH")
plt.savefig('/Users/en-ce-4530/Desktop/Team 4/ANC lab/pHvsTitrantvolume ')
plt.tight_layout()
plt.show()

##This gran function was written by Monroe Weber-Shirk
#Define the gran function.
def F1(V_sample,V_titrant,pH):
  return (V_sample + V_titrant)/V_sample * epa.invpH(pH)
#Create an array of the F1 values.
V_titrant
F1_data = F1(V_Sample,V_titrant,pH)
#By inspection I guess that there are 4 good data points in the linear region.
N_good_points = 3
#use scipy linear regression. Note that the we can extract the last n points from an array using the notation [-N:]
slope, intercept, r_value, p_value, std_err = stats.linregress(V_titrant[-N_good_points:],F1_data[-N_good_points:])
#reattach the correct units to the slope and intercept.
intercept = intercept*u.mole/u.L
slope = slope*(u.mole/u.L)/u.mL
V_eq = -intercept/slope
ANC_sample = V_eq*Normality_Titrant/V_Sample
print('The r value for this curve fit is', r_value)
print('The equivalent volume was', V_eq)
print('The acid neutralizing capacity was', ANC_sample.to(u.meq/u.L))

#The equivalent volume agrees well with the value calculated by ProCoDA.
#create an array of points to draw the linear regression line
x=[V_eq.magnitude,V_titrant[-1].magnitude ]
y=[0,(V_titrant[-1]*slope+intercept).magnitude]
#Now plot the data and the linear regression
plt.plot(V_titrant, F1_data,'o')
V_titrant
F1_data
plt.plot(x, y,'r')
plt.xlabel('Titrant Volume (mL)')
plt.ylabel('Gran function (mole/L)')
plt.legend(['data'])
plt.savefig('/Users/en-ce-4530/Desktop/Team 4/ANC lab/time 0 ')
plt.tight_layout()
plt.show()


#Plotting the measured ANC
Kw = 10**(-14) * (u.mole/u.L)**2
K1_carbonate = 10**(-6.37)*u.mol/u.L
K2_carbonate = 10**(-10.25)*u.mol/u.L
K_Henry_CO2 = 10**(-1.5) * u.mole/(u.L*u.atm)
P_CO2 = 10**(-3.5) * u.atm

##The below functions are from the Aguaclara code base

def invpH(pH):
    #This function calculates inverse pH
    #Parameters

    return 10**(-pH)*u.mol/u.L


def alpha0_carbonate(pH):
    #This function calculates the fraction of total carbonates of the form
    #H2CO3
    #Parameters


    alpha0_carbonate = 1/(1+(K1_carbonate/invpH(pH)) *
                            (1+(K2_carbonate/invpH(pH))))
    return alpha0_carbonate


def alpha1_carbonate(pH):
    #This function calculates the fraction of total carbonates of the form
    #HCO3-
    #Parameters

    alpha1_carbonate = 1/((invpH(pH)/K1_carbonate) + 1 +
                          (K2_carbonate/invpH(pH)))
    return alpha1_carbonate


def alpha2_carbonate(pH):
    #This function calculates the fraction of total carbonates of the form
    #CO3-2
    #Parameters

    alpha2_carbonate = 1/(1+(invpH(pH)/K2_carbonate) *
                            (1+(invpH(pH)/K1_carbonate)))
    return alpha2_carbonate


def ANC_closed(pH, Total_Carbonates):
    #Acid neutralizing capacity (ANC) calculated under a closed system where
    #there are no carbonates exchanged with the atmosphere during the
    #experiment. Based on pH and total carbonates in the system.

    return (Total_Carbonates * (u.eq/u.mol * alpha1_carbonate(pH) +
            2 * u.eq/u.mol * alpha2_carbonate(pH)) +
            1 * u.eq/u.mol * Kw/invpH(pH) - 1 * u.eq/u.mol * invpH(pH))

def ANC_open(pH):
    #Acid neutralizing capacity (ANC) calculated under an open system, based
    #on pH.
    return ANC_closed(pH, P_CO2*K_Henry_CO2/alpha0_carbonate(pH))


data_file_path = "https://raw.githubusercontent.com/el545/el545-4530/master/Acid%20Rain/lab2%20acid%20rain%20(1).tsv"
#Now we create a pandas dataframe with the data in the file


time = epa.column_of_data(data_file_path,1,1,-1,"")
pHcalc = epa.column_of_data(data_file_path,1,0,-1,"")
display(pHcalc)
ANC_input = -0.001 *u.eq/u.L
ANC_o = 50 * (u.eq/u.L)*10**(-6)
Ct = ANC_o*np.exp(-time)

conservativeANC = (ANC_input)*(1-(np.exp(-time)))+ (ANC_o)*(np.exp(-time))


ANC_input = -0.001 *u.eq/u.L
ANC_out = 50 * (u.eq/u.L)*10**(-6)
TC= 1.854*(u.eq/u.L)*10**(-3)
closedANC = ANC_closed(pHcalc, Ct)



ANC_input = -0.001 *u.eq/u.L
ANC_out = 50 * (u.eq/u.L)*10**(-6)
openANC= ANC_open(pHcalc)

residencetime = 609.137

t_over_theta = np.array([0*60, 5*60, 10*60, 15*60, 20*60])/residencetime
ANC0 = ANC0/(u.mol/u.L)*(u.eq/u.L)
data5 = "https://raw.githubusercontent.com/el545/el545-4530/master/ANC%20Titrations/lab%203%20titration%20time%205.tsv"
V_titrant, pH, V_Sample, Normality_Titrant, V_equivalent, ANC = epa.Gran(data5)
ANC5 = ANC/(u.mol/u.L)*(u.eq/u.L)
data10 = 'https://raw.githubusercontent.com/el545/el545-4530/master/ANC%20Titrations/lab%203%20time%2010.tsv'
V_titrant, pH, V_Sample, Normality_Titrant, V_equivalent, ANC = epa.Gran(data10)
ANC10 = ANC/(u.mol/u.L)*(u.eq/u.L)
data15 = 'https://raw.githubusercontent.com/el545/el545-4530/master/ANC%20Titrations/lab3%20t%2015%20first%20try.tsv'
V_titrant, pH, V_Sample, Normality_Titrant, V_equivalent, ANC = epa.Gran(data15)
ANC15 = ANC/(u.mol/u.L)*(u.eq/u.L)
data20 = 'https://raw.githubusercontent.com/el545/el545-4530/master/ANC%20Titrations/lab%203%20t%2020.tsv'
V_titrant, pH, V_Sample, Normality_Titrant, V_equivalent, ANC = epa.Gran(data20)
ANC20 = ANC/(u.mol/u.L)*(u.eq/u.L)
anc_data = [ANC0, ANC5, ANC10, ANC15, ANC20]
anc_data = (np.stack(anc_data))*(u.eq/u.L)
anc_data


ancCOMP = [anc_data, t_over_theta]
plt.plot(time, conservativeANC, 'r')
plt.scatter(t_over_theta, anc_data, c='g', marker = 'o')
plt.plot(time, closedANC, 'b')
plt.plot(time, openANC, 'y')
plt.xlabel('t/theta')
plt.ylabel('ANC')
plt.legend(['conservative ANC','closed ANC','open ANC', 'Data'])
plt.grid(True)
plt.savefig('/Users/en-ce-4530/Desktop/Team 4/ANC lab/part3')
plt.show()
